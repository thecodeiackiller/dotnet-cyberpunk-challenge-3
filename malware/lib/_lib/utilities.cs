using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Threading.Tasks;
using dotnet_cyberpunk_challenge_3.malware.lib._lib;

namespace dotnet_cyberpunk_challenge_3.malware.lib
{
    public enum EncryptionType {
        SSL = 0,
        CLEAR_TEXT = 1,

    }

    public class KnownIceTypes {
        public const string HITACHI = "0x98ad4321";
        public const string HOSAKA = "0x43ce4691";
        public const string KIROSHI = "0x02ace587";
        public const string UNKNOWN = "unknown"; 
    }

    static class HttpResponseMessageExtensions
    {
        internal static void WriteRequestToConsole(this HttpResponseMessage response)
        {
            if (response is null)
            {
                return;
            }

            var request = response.RequestMessage;
            Console.Write($"{request?.Method} ");
            Console.Write($"{request?.RequestUri} ");
            Console.WriteLine($"HTTP/{request?.Version}");        
        }
    }

    static class Helpers {
        public static Dictionary<string,string> JsonToDictionary(this string json) {
            Dictionary<string, object>? objectValues = JsonSerializer.Deserialize<Dictionary<string, object>>(json);

            IEnumerable<KeyValuePair<string, string>> stringValues = objectValues.Select(o => new KeyValuePair<string, string>(o.Key, o.Value?.ToString()));
            return stringValues.ToDictionary(pair => pair.Key, pair => pair.Value);
        }

        public static BiotechnicaMessageRoot ToArasakaMessage(this string json){
            BiotechnicaMessageRoot message = JsonSerializer.Deserialize<BiotechnicaMessageRoot>(json);
            Console.WriteLine("I'm in the ToArasakaMessage method in the utilities class");
            return message;
        }

        public static MilitechMessageRoot ToMilitechMessage(this string json){
            MilitechMessageRoot message = JsonSerializer.Deserialize<MilitechMessageRoot>(json);
            return message;
        }

        public static BiotechnicaMessageRoot ToBiotechnicaMessage(this string json)
        {
            BiotechnicaMessageRoot message = JsonSerializer.Deserialize<BiotechnicaMessageRoot>(json);
            return message;
            // Biotechnica is an extension method on string type
            // As we are getting our connections with each service, we come into the helpers class to get a message it appears
            // We can't genericize these methods because they are static methods. 
        }
    }

}